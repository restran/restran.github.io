---
title: Git 代码版本还原方法
layout: post
category: [工具]
tagline: 
keywords: [git, 还原, 恢复, 教程, 版本还原, tortoise git]
tags: [Git]
---

在使用 Git 管理自己的代码和资料时，难免会遇到意料之外的事。比如误操作，将当前的分支删除；或者重置到某个版本，然后发现自己想要的代码找不到了；又或者需要还原到之前提交的某个版本，但是那个版本已经被重置过，在历史中找不到了。

忙活了大半天，发现辛苦换来的成果都没了，遇到这种情况几乎是要崩溃的，不过幸好我们还有 Git。

一般情况下，如果在版本的分支历史上，还可以找到想要的那个版本，那通常比较简单，只要选择重置到该版本就可以了。

![git_0.png](/uploads/post_img/2016/02/git_0.png "")

重置类型有三种模式可供选择，soft、mixed 和 hard 的区别如下：

**soft 不改动工作区和索引**

假设有一些 commits

    A - B - C (master)

HEAD 指向 C， 并且暂存区（stage，或称为 index）matches C.

当使用 `git reset --soft B` 时，master 和 HEAD 指向 B，但是依然保留了 C 添加跟踪的文件，此时会将这些文件放入暂存区中，显示为已缓存。同时工作区中修改的文件，显示为未缓存。

**mixed 保持工作区不变，重置索引**

当使用 `git reset --mixed B` 时，master 和 HEAD 指向 B，这时候 C 添加跟踪的文件仍然会在，但是会显示为未缓存（不是版本控制），而当前工作目录中的修改内容，仍然会在，显示未缓存的状态

（如果不知道怎么选，默认使用 mixed）

**hard 重置索引和工作区（丢弃所有本地变更）**

当使用 `git reset --hard B` 时，C 添加跟踪的文件，以及当前工作目录中的修改内容，都会丢失。

---

如果比较悲剧，分支历史上已经找不到想要的那个版本的代码了，但是别急，只要是有提交的代码，Git 都能找回来。

我在 Windows 下使用 TortoiseGit，只要右键找到`显示引用记录`，就能找到所有的操作记录，然后选择想要的版本，重置过去就可以了。即便是现在这一步的重置操作选错了版本也没事，因为这个操作也被记录下来，你还是可以重置到正确的版本。

![git_0.png](/uploads/post_img/2016/02/git_1.png "")

看到这张图，是不是一股暖流涌上心头，终于找回来了。

![git_0.png](/uploads/post_img/2016/02/git_2.png "")

曾经尝试过用命令来操作，但是试了很久都没成功，只好放弃，改用 TortoiseGit 来操作。TortoiseGit 在 Windows 下几乎是最好用的 Git GUI 工具了。

自从使用了 Git，只要有 `commit` 过的代码，再也不担心会丢了，尽情的 `commit` 吧。

